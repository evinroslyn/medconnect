<div class="flex flex-1 flex-col overflow-y-auto bg-white">
  <!-- Header -->
<header class="flex flex-col h-auto shrink-0 border-b border-border-dark bg-background-dark px-8 py-4">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-lg font-bold text-text-dark-primary">Gestion des Patients</h2>
      </div>
<div class="flex flex-1 items-center justify-end gap-4">
<label class="relative flex min-w-40 max-w-sm flex-col">
<div class="flex h-10 w-full flex-1 items-stretch">
<div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
            <span class="material-symbols-outlined text-text-dark-primary">search</span>
</div>
          <input
            class="form-input h-full w-full min-w-0 flex-1 resize-none overflow-hidden border border-border-dark bg-background-dark/50 px-4 pl-10 text-sm placeholder:text-text-dark-primary/70 text-text-dark-primary focus:border-primary focus:outline-0 focus:ring-2 focus:ring-primary/20"
            placeholder="Rechercher des patients par nom ou ID..."
            [(ngModel)]="searchTerm"
            (input)="filterPatients()"
          />
</div>
</label>
      <button class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden bg-transparent hover:bg-background-dark/20">
        <span class="material-symbols-outlined text-text-dark-primary">notifications</span>
</button>
      <div
        *ngIf="userProfile?.photoProfil"
        class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-white/20"
        [style.background-image]="'url(' + getDocumentUrl(userProfile.photoProfil) + ')'"
      ></div>
      <div
        *ngIf="!userProfile?.photoProfil"
        class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-background-dark/20 flex items-center justify-center border-2 border-white/20"
      >
        <span class="material-symbols-outlined text-white text-xl">person</span>
      </div>
    </div>
    </div>
</header>

  <!-- Main Content -->
<main class="flex-1 p-8">
      <!-- Loading State -->
      <div *ngIf="loading" class="text-center py-12">
        <p class="text-text-light-primary dark:text-text-dark-primary">Chargement des patients...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="text-center py-12">
        <p class="text-red-600 mb-4">{{ error }}</p>
        <button (click)="loadPatients()" class="px-4 py-2 bg-primary text-white">Réessayer</button>
      </div>

      <!-- Patients List -->
      <div *ngIf="!loading && !error">
        <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
          <h1 class="text-xl font-black tracking-tight text-text-light-primary dark:text-text-dark-primary">Liste des Patients</h1>
            <p class="text-sm text-text-light-primary dark:text-text-dark-primary mt-1">Gérez et consultez les informations de vos patients</p>
        </div>

      <!-- Filters -->
      <div class="flex gap-3 py-4">
              <button class="flex h-9 shrink-0 items-center justify-center gap-x-2 border border-border-light bg-surface-light px-3 py-1.5 text-sm font-medium hover:border-primary dark:border-border-dark dark:bg-surface-dark dark:hover:border-primary">
      <span>Tous les Patients</span>
      <span class="material-symbols-outlined text-base">expand_more</span>
      </button>
              <button class="flex h-9 shrink-0 items-center justify-center gap-x-2 border border-border-light bg-surface-light px-3 py-1.5 text-sm font-medium hover:border-primary dark:border-border-dark dark:bg-surface-dark dark:hover:border-primary">
      <span>Trier par: Dernière Visite</span>
      <span class="material-symbols-outlined text-base">expand_more</span>
      </button>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredPatients.length === 0" class="mt-8 text-center py-12">
        <p class="text-text-light-primary dark:text-text-dark-primary">
          Aucun patient n'a encore accordé l'accès à ses dossiers médicaux.
        </p>
      </div>

      <!-- Patients Table -->
        <div *ngIf="filteredPatients.length > 0" class="mt-4 overflow-hidden border border-border-dark bg-white dark:bg-background-dark/50 rounded-lg">
        <div class="overflow-x-auto">
        <table class="min-w-full table-auto">
        <thead class="bg-background-dark">
        <tr>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">NOM DU PATIENT</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">ID PATIENT</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">DERNIÈRE VISITE</th>
                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">STATUT</th>
        <th class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-text-dark-primary">ACTIONS</th>
        </tr>
        </thead>
        <tbody class="bg-white dark:bg-background-dark/30 divide-y divide-border-dark">
              <tr
                *ngFor="let patient of getPaginatedPatients()"
                class="hover:bg-background-dark/10 cursor-pointer transition-colors"
                (click)="viewPatientProfile(patient.idPatient)"
              >
        <td class="whitespace-nowrap px-6 py-4">
        <div class="flex items-center gap-3">
                    <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-background-dark/20 flex items-center justify-center">
                      <span class="material-symbols-outlined text-text-light-primary dark:text-text-dark-primary">person</span>
                    </div>
        <div>
            <div class="text-sm font-medium text-text-light-primary dark:text-text-dark-primary">{{ patient.patientNom }}</div>
            <div class="text-xs text-text-light-primary dark:text-text-dark-primary">{{ getPatientBirthDate(patient) }}</div>
        </div>
        </div>
        </td>
            <td class="whitespace-nowrap px-6 py-4 text-sm text-text-light-primary dark:text-text-dark-primary">{{ patient.idPatient }}</td>
            <td class="whitespace-nowrap px-6 py-4 text-sm text-text-light-primary dark:text-text-dark-primary">
            {{ patient.dateAcceptation | date:'yyyy-MM-dd' }}
        </td>
        <td class="whitespace-nowrap px-6 py-4">
            <span [class]="'inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ' + getStatusClass(patient.statutConnexion)">
            {{ getStatusLabel(patient.statutConnexion) }}
            </span>
        </td>
        <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
                          <a (click)="viewPatientProfile(patient.idPatient); $event.stopPropagation()" class="text-primary hover:text-primary/80 cursor-pointer">Voir le Dossier</a>
        </td>
        </tr>
        </tbody>
        </table>
        </div>
        </div>

      <!-- Pagination -->
      <div *ngIf="filteredPatients.length > 0" class="mt-6 flex items-center justify-between">
        <p class="text-sm text-text-light-primary dark:text-text-dark-primary">
          Affichage de <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span> à
          <span class="font-medium">{{ getMinValue(currentPage * itemsPerPage, totalItems) }}</span> sur
          <span class="font-medium">{{ totalItems }}</span> résultats
        </p>
      <div class="flex items-center gap-2">
          <button
            (click)="goToPage(currentPage - 1)"
            [disabled]="currentPage === 1"
            class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 disabled:opacity-50 disabled:cursor-not-allowed dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
          >
      <span class="material-symbols-outlined text-base">chevron_left</span>
      </button>
          <button
            *ngFor="let page of [].constructor(getTotalPages()); let i = index"
            (click)="goToPage(i + 1)"
            [class.border-primary]="currentPage === i + 1"
            [class.bg-primary]="currentPage === i + 1"
            [class.text-white]="currentPage === i + 1"
            class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
          >
            {{ i + 1 }}
          </button>
          <button
            (click)="goToPage(currentPage + 1)"
            [disabled]="currentPage === getTotalPages()"
            class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 disabled:opacity-50 disabled:cursor-not-allowed dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
          >
      <span class="material-symbols-outlined text-base">chevron_right</span>
      </button>
        </div>
</div>
</div>
</main>
</div>

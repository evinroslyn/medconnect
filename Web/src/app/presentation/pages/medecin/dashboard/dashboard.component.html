  <div class="flex flex-1 flex-col overflow-y-auto bg-white">
  <!-- Header -->
    <header class="flex flex-col h-auto shrink-0 border-b border-border-dark bg-background-dark px-8 py-4">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-lg font-bold text-text-dark-primary">Tableau de Bord</h2>
      </div>
      <div class="flex flex-1 items-center justify-end gap-4">
        <label class="relative flex min-w-40 max-w-sm flex-col">
          <div class="flex h-10 w-full flex-1 items-stretch">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
            <span class="material-symbols-outlined text-text-dark-primary">search</span>
            </div>
            <input
            class="form-input h-full w-full min-w-0 flex-1 resize-none overflow-hidden border border-border-dark bg-background-dark/50 px-4 pl-10 text-sm placeholder:text-text-dark-primary/70 text-text-dark-primary focus:border-primary focus:outline-0 focus:ring-2 focus:ring-primary/20"
              placeholder="Rechercher des patients par nom ou ID..."
              [(ngModel)]="searchTerm"
              (input)="filterPatients()"
            />
          </div>
        </label>
      <button class="flex h-10 w-10 cursor-pointer items-center justify-center overflow-hidden bg-transparent hover:bg-background-dark/20 rounded-lg transition-colors">
        <span class="material-symbols-outlined text-text-dark-primary">notifications</span>
      </button>
      <div
        *ngIf="userProfile?.photoProfil"
        class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-white/20"
        [style.background-image]="'url(' + getDocumentUrl(userProfile.photoProfil) + ')'"
      ></div>
      <div
        *ngIf="!userProfile?.photoProfil"
        class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-background-dark/20 flex items-center justify-center border-2 border-white/20"
      >
        <span class="material-symbols-outlined text-white text-xl">person</span>
      </div>
      </div>
    </div>
    </header>

    <main class="flex-1 p-8">
      <!-- Loading State -->
      <div *ngIf="loading" class="text-center py-12">
      <p class="text-text-light-primary dark:text-text-dark-primary">Chargement des patients...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error && !loading" class="mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded">
        <p class="text-red-800 dark:text-red-200 text-sm">{{ error }}</p>
        <button (click)="error = null; loadPatients(); loadPendingRequests()" class="mt-2 px-4 py-2 bg-primary text-white text-sm rounded-lg hover:bg-primary/90 transition-colors">
          Fermer
        </button>
    </div>

    <!-- Dashboard Content -->
    <div *ngIf="!loading && !error">
      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white dark:bg-background-dark border border-border-light dark:border-border-dark p-6 rounded-lg shadow-sm">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-text-light-primary dark:text-text-dark-primary mb-1">Total de Patients</p>
              <p class="text-3xl font-bold text-text-light-primary dark:text-text-dark-primary">{{ filteredPatients.length }}</p>
            </div>
            <div class="h-12 w-12 bg-background-dark/20 flex items-center justify-center">
              <span class="material-symbols-outlined text-primary text-2xl">group</span>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-background-dark border border-border-light dark:border-border-dark p-6 rounded-lg shadow-sm">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-text-light-primary dark:text-text-dark-primary mb-1">Patients Actifs</p>
              <p class="text-3xl font-bold text-text-light-primary dark:text-text-dark-primary">{{ getActivePatientsCount() }}</p>
            </div>
            <div class="h-12 w-12 bg-status-green/10 flex items-center justify-center">
              <span class="material-symbols-outlined text-status-green text-2xl">check_circle</span>
            </div>
          </div>
        </div>
        <div class="bg-white dark:bg-background-dark border border-border-light dark:border-border-dark p-6 rounded-lg shadow-sm">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm text-text-light-primary dark:text-text-dark-primary mb-1">Visites Récentes</p>
              <p class="text-3xl font-bold text-text-light-primary dark:text-text-dark-primary">{{ getRecentVisitsCount() }}</p>
            </div>
            <div class="h-12 w-12 bg-background-dark/20 flex items-center justify-center">
              <span class="material-symbols-outlined text-primary text-2xl">calendar_today</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Connection Requests -->
      <div *ngIf="pendingRequests.length > 0" class="mb-8">
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-xl font-bold text-text-light-primary dark:text-text-dark-primary">Demandes de Connexion en Attente</h2>
            <p class="text-sm text-text-light-primary/90 dark:text-text-dark-primary/90 mt-1">Approuvez ou rejetez les demandes d'accès des patients</p>
          </div>
        </div>
        <div class="border border-border-dark bg-white dark:bg-background-dark overflow-hidden rounded-lg shadow-sm">
          <div class="overflow-x-auto">
            <table class="min-w-full table-auto">
              <thead class="bg-background-dark">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">NOM DU PATIENT</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">TÉLÉPHONE</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">EMAIL</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">DATE DE DEMANDE</th>
                  <th class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-text-dark-primary">ACTIONS</th>
                </tr>
              </thead>
              <tbody class="bg-white dark:bg-background-dark divide-y divide-border-dark">
                <tr
                  *ngFor="let request of getPaginatedRequests()"
                  class="hover:bg-background-dark/10 transition-colors"
                >
                  <td class="whitespace-nowrap px-6 py-4">
                    <div class="flex items-center gap-3">
                      <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-background-dark/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-text-dark-primary/90">person</span>
                      </div>
                      <div>
                        <div class="text-sm font-medium text-text-light-primary dark:text-text-dark-primary">{{ request.patientNom }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="whitespace-nowrap px-6 py-4 text-sm text-text-light-primary dark:text-text-dark-primary">{{ request.patientTelephone || 'N/A' }}</td>
                  <td class="whitespace-nowrap px-6 py-4 text-sm text-text-light-primary dark:text-text-dark-primary">{{ request.patientMail || 'N/A' }}</td>
                  <td class="whitespace-nowrap px-6 py-4 text-sm text-text-light-primary dark:text-text-dark-primary">
                    {{ request.dateCreation | date:'yyyy-MM-dd HH:mm' }}
                  </td>
                  <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
                    <div class="flex gap-2 justify-end">
                      <button
                        (click)="acceptRequest(request.id); $event.stopPropagation()"
                        class="px-3 py-1 bg-status-green text-white text-xs font-medium hover:bg-status-green/90 rounded"
                      >
                        Accepter
                      </button>
                      <button
                        (click)="rejectRequest(request.id); $event.stopPropagation()"
                        class="px-3 py-1 bg-red-600 text-white text-xs font-medium hover:bg-red-700 rounded-lg transition-colors"
                      >
                        Rejeter
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Pagination pour les demandes -->
        <div *ngIf="pendingRequests.length > 0" class="mt-4 flex items-center justify-between px-6 py-3 border-t border-border-dark">
          <p class="text-sm text-text-light-primary dark:text-text-dark-primary">
            Affichage de <span class="font-medium">{{ (currentPageRequests - 1) * itemsPerPageRequests + 1 }}</span> à
            <span class="font-medium">{{ getMinValue(currentPageRequests * itemsPerPageRequests, pendingRequests.length) }}</span> sur
            <span class="font-medium">{{ pendingRequests.length }}</span> résultats
          </p>
          <div class="flex items-center gap-2">
            <button
              (click)="goToPageRequests(currentPageRequests - 1)"
              [disabled]="currentPageRequests === 1"
              class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 disabled:opacity-50 disabled:cursor-not-allowed dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
            >
              <span class="material-symbols-outlined text-base">chevron_left</span>
            </button>
            <button
              *ngFor="let page of [].constructor(getTotalPagesRequests()); let i = index"
              (click)="goToPageRequests(i + 1)"
              [class.border-primary]="currentPageRequests === i + 1"
              [class.bg-primary]="currentPageRequests === i + 1"
              [class.text-white]="currentPageRequests === i + 1"
              class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
            >
              {{ i + 1 }}
            </button>
            <button
              (click)="goToPageRequests(currentPageRequests + 1)"
              [disabled]="currentPageRequests === getTotalPagesRequests()"
              class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 disabled:opacity-50 disabled:cursor-not-allowed dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
            >
              <span class="material-symbols-outlined text-base">chevron_right</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Recent Patients -->
      <div>
        <div class="flex items-center justify-between mb-4">
          <div>
            <h2 class="text-xl font-bold text-text-light-primary dark:text-text-dark-primary">Patients Récents</h2>
            <p class="text-sm text-text-light-primary/90 dark:text-text-dark-primary/90 mt-1">Liste des patients ayant récemment accordé l'accès</p>
          </div>
          <a
            (click)="navigateToPatients()"
            class="text-sm font-medium text-primary hover:text-primary/80 cursor-pointer"
          >
            Voir Tout
          </a>
        </div>

        <div *ngIf="filteredPatients.length === 0" class="text-center py-12 border border-border-light dark:border-border-dark bg-white dark:bg-background-dark rounded-lg shadow-sm">
          <p class="text-text-light-primary dark:text-text-dark-primary">
            Aucun patient n'a encore accordé l'accès à ses dossiers médicaux.
          </p>
        </div>

        <div *ngIf="filteredPatients.length > 0" class="border border-border-dark bg-white/90 dark:bg-background-dark/90 backdrop-blur-sm overflow-hidden rounded-lg shadow-lg">
          <div class="overflow-x-auto">
            <table class="min-w-full table-auto">
              <thead class="bg-background-dark">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">NOM DU PATIENT</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">ID PATIENT</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">DERNIÈRE VISITE</th>
                  <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-text-dark-primary">STATUT</th>
                  <th class="px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-text-dark-primary">ACTIONS</th>
                </tr>
              </thead>
              <tbody class="bg-white dark:bg-background-dark divide-y divide-border-dark">
                <tr
                  *ngFor="let patient of getPaginatedPatients()"
                  class="hover:bg-background-dark/10 cursor-pointer transition-colors"
                  (click)="viewPatientProfile(patient.idPatient)"
                >
                  <td class="whitespace-nowrap px-6 py-4">
                    <div class="flex items-center gap-3">
                      <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-background-dark/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-text-light-primary dark:text-text-dark-primary">person</span>
                      </div>
                      <div>
                        <div class="text-sm font-medium text-text-light-primary dark:text-text-dark-primary">{{ patient.patientNom }}</div>
                        <div class="text-xs text-text-light-primary dark:text-text-dark-primary">{{ patient.patientMail }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="whitespace-nowrap px-6 py-4 text-sm text-text-light-primary dark:text-text-dark-primary">{{ patient.idPatient }}</td>
                  <td class="whitespace-nowrap px-6 py-4 text-sm text-text-light-primary dark:text-text-dark-primary">
                    {{ patient.dateAcceptation | date:'yyyy-MM-dd' }}
                  </td>
                  <td class="whitespace-nowrap px-6 py-4">
                    <span class="inline-flex items-center rounded-full bg-status-green/10 px-2.5 py-0.5 text-xs font-medium text-status-green">
                      {{ patient.statutConnexion === 'Accepté' ? 'Active' : patient.statutConnexion }}
                    </span>
                  </td>
                  <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
                    <a (click)="viewPatientProfile(patient.idPatient); $event.stopPropagation()" class="text-primary hover:text-primary/80 cursor-pointer">Voir le Dossier</a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination pour les patients récents -->
          <div *ngIf="filteredPatients.length > 0" class="mt-4 flex items-center justify-between px-6 py-3 border-t border-border-dark">
            <p class="text-sm text-text-light-primary dark:text-text-dark-primary">
              Affichage de <span class="font-medium">{{ (currentPagePatients - 1) * itemsPerPagePatients + 1 }}</span> à
              <span class="font-medium">{{ getMinValue(currentPagePatients * itemsPerPagePatients, filteredPatients.length) }}</span> sur
              <span class="font-medium">{{ filteredPatients.length }}</span> résultats
            </p>
            <div class="flex items-center gap-2">
              <button
                (click)="goToPagePatients(currentPagePatients - 1)"
                [disabled]="currentPagePatients === 1"
                class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 disabled:opacity-50 disabled:cursor-not-allowed dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
              >
                <span class="material-symbols-outlined text-base">chevron_left</span>
              </button>
              <button
                *ngFor="let page of [].constructor(getTotalPagesPatients()); let i = index"
                (click)="goToPagePatients(i + 1)"
                [class.border-primary]="currentPagePatients === i + 1"
                [class.bg-primary]="currentPagePatients === i + 1"
                [class.text-white]="currentPagePatients === i + 1"
                class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
              >
                {{ i + 1 }}
              </button>
              <button
                (click)="goToPagePatients(currentPagePatients + 1)"
                [disabled]="currentPagePatients === getTotalPagesPatients()"
                class="flex h-8 w-8 items-center justify-center border border-border-light bg-surface-light text-sm font-medium hover:bg-background-dark/20 disabled:opacity-50 disabled:cursor-not-allowed dark:border-border-dark dark:bg-surface-dark dark:hover:bg-background-dark/20"
              >
                <span class="material-symbols-outlined text-base">chevron_right</span>
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>
    </main>
</div>
